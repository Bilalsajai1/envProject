<!-- src/app/auth/login/login.component.html -->

<div class="account-pages my-5 pt-sm-5">
  <div class="container login-page-container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-5">
        <div class="card login-card overflow-hidden p-4">

          <!-- HEADER -->
          <div class="card-header text-center border-0 bg-transparent">
            <div class="mb-3">
              <img
                src="assets/logo-perenity-software.svg"
                class="login-logo img-fluid"
                alt="Perenity Software"
              />
            </div>
            <h4 class="mb-1 text-primary">Bienvenue</h4>
            <p class="text-muted mb-0">
              Connectez-vous pour accéder à la plateforme de gestion des environnements
            </p>
            <hr class="mt-3 mb-0" />
          </div>

          <!-- BODY -->
          <div class="card-body">

            <!-- Message d'erreur global -->
            <div
              class="alert alert-danger d-flex align-items-center mb-3"
              *ngIf="error"
            >
              <mat-icon class="me-2">error_outline</mat-icon>
              <span>{{ error }}</span>
            </div>

            <form [formGroup]="form" (ngSubmit)="submit()">

              <!-- Username -->
              <div class="mb-3">
                <label class="form-label">Nom d'utilisateur</label>
                <mat-form-field appearance="outline" class="w-100">
                  <mat-icon matPrefix>person</mat-icon>
                  <input
                    matInput
                    formControlName="username"
                    autocomplete="username"
                  />
                  <mat-error
                    *ngIf="
                      form.get('username')?.touched &&
                      form.get('username')?.hasError('required')
                    "
                  >
                    Le nom d'utilisateur est obligatoire
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- Password -->
              <div class="mb-3">
                <label class="form-label">Mot de passe</label>
                <mat-form-field appearance="outline" class="w-100">
                  <mat-icon matPrefix>lock</mat-icon>
                  <input
                    matInput
                    [type]="hidePassword ? 'password' : 'text'"
                    formControlName="password"
                    autocomplete="current-password"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    type="button"
                    (click)="hidePassword = !hidePassword"
                    [attr.aria-label]="'Masquer le mot de passe'"
                    tabindex="-1"
                  >
                    <mat-icon>
                      {{ hidePassword ? 'visibility_off' : 'visibility' }}
                    </mat-icon>
                  </button>
                  <mat-error
                    *ngIf="
                      form.get('password')?.touched &&
                      form.get('password')?.hasError('required')
                    "
                  >
                    Le mot de passe est obligatoire
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- Remember me + Mot de passe oublié -->
              <div
                class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"
              >
                <mat-checkbox formControlName="rememberMe">
                  Se souvenir de moi
                </mat-checkbox>

                <a
                  class="forgot-password-link text-muted"
                  (click)="goToForgotPassword()"
                >
                  <i class="mdi mdi-lock me-1"></i> Mot de passe oublié ?
                </a>
              </div>

              <!-- Bouton de connexion -->
              <div class="mt-3 d-grid">
                <button
                  mat-raised-button
                  color="primary"
                  class="w-100 login-button"
                  type="submit"
                  [disabled]="loading || form.invalid"
                >
                  <mat-progress-spinner
                    *ngIf="loading"
                    diameter="20"
                    mode="indeterminate"
                    strokeWidth="2"
                    class="spinner me-2"
                  >
                  </mat-progress-spinner>
                  <span *ngIf="!loading">Se connecter</span>
                  <span *ngIf="loading">Connexion en cours...</span>
                </button>
              </div>

            </form>
          </div>

          <!-- FOOTER -->
          <div class="card-footer text-center bg-transparent border-0">
            <div class="mt-3">
              <p class="mb-0 text-muted">
                &copy; 2025 Perenity Software - Tous droits réservés
              </p>
              <small class="text-muted">
                Plateforme de gestion des environnements
              </small>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
