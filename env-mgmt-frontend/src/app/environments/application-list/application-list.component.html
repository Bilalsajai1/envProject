<div class="application-list-container">

  <nav class="breadcrumb">
    <mat-icon>home</mat-icon>
    <span>{{ typeCode }}</span>
    <mat-icon>chevron_right</mat-icon>
    <a (click)="goBack()" class="breadcrumb-link">Environnements</a>
    <mat-icon>chevron_right</mat-icon>
    <span class="current">Applications</span>
  </nav>

  <div class="list-header">
    <div>
      <h2>
        <mat-icon>apps</mat-icon>
        Applications
      </h2>
      <p class="subtitle">
        Gérez les applications déployées dans cet environnement
      </p>
    </div>

    <div class="header-actions">
      <button
        mat-stroked-button
        (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour
      </button>

      <button
        mat-raised-button
        color="primary"
        (click)="addApplication()">
        <mat-icon>add</mat-icon>
        Ajouter une Application
      </button>
    </div>
  </div>

  @if (!loading) {
    <mat-card>
      <table
        mat-table
        [dataSource]="applications"
        class="applications-table">

        <ng-container matColumnDef="applicationCode">
          <th mat-header-cell *matHeaderCellDef>Code</th>
          <td mat-cell *matCellDef="let app">
            <span class="app-code">{{ app.applicationCode }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="applicationLibelle">
          <th mat-header-cell *matHeaderCellDef>Application</th>
          <td mat-cell *matCellDef="let app">
            <strong>{{ app.applicationLibelle }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="protocole">
          <th mat-header-cell *matHeaderCellDef>Protocole</th>
          <td mat-cell *matCellDef="let app">
            @if (app.protocole) {
              <mat-chip class="protocol-chip">
                {{ app.protocole }}
              </mat-chip>
            } @else {
              <span>-</span>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="host">
          <th mat-header-cell *matHeaderCellDef>Host</th>
          <td mat-cell *matCellDef="let app">
            <span class="host-text">{{ app.host || '-' }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="port">
          <th mat-header-cell *matHeaderCellDef>Port</th>
          <td mat-cell *matCellDef="let app">
            {{ app.port || '-' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actif">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let app">
            <mat-chip
              [class.status-active]="app.actif"
              [class.status-inactive]="!app.actif">
              {{ app.actif ? 'Actif' : 'Inactif' }}
            </mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let app" class="actions-cell">
            <button
              mat-icon-button
              (click)="editApplication(app)"
              matTooltip="Modifier"
              color="primary">
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="deleteApplication(app)"
              matTooltip="Supprimer"
              color="warn">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

      @if (applications.length === 0) {
        <div class="empty-state">
          <mat-icon>apps</mat-icon>
          <p>Aucune application trouvée</p>
          <p class="hint">Ajoutez votre première application à cet environnement</p>
        </div>
      }

    </mat-card>
  } @else {
    <div class="loading-state">
      <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      <p>Chargement des applications...</p>
    </div>
  }

</div>
