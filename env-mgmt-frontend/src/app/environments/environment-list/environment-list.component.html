<!-- src/app/environments/components/environment-list/environment-list.component.html -->

<div class="environment-list-container">

  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <mat-icon>home</mat-icon>
    <span>{{ typeCode }}</span>
    <mat-icon>chevron_right</mat-icon>
    <a (click)="goBack()" class="breadcrumb-link">Projets</a>
    <mat-icon>chevron_right</mat-icon>
    <span class="current">{{ project?.libelle || 'Environnements' }}</span>
  </nav>

  <!-- Header -->
  <div class="list-header">
    <div>
      <h2>
        <mat-icon>layers</mat-icon>
        Environnements
      </h2>
      <p class="subtitle" *ngIf="project">
        Projet : <strong>{{ project.libelle }}</strong> ({{ project.code }})
      </p>
    </div>

    <div class="header-actions">
      <button
        mat-stroked-button
        (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour aux projets
      </button>

      <button
        mat-raised-button
        color="primary"
        (click)="addEnvironment()">
        <mat-icon>add</mat-icon>
        Nouvel Environnement
      </button>
    </div>
  </div>

  <!-- Carte -->
  <mat-card *ngIf="!loading; else loadingTpl">
    <table
      mat-table
      [dataSource]="environments"
      class="environments-table">

      <!-- Code -->
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef>Code</th>
        <td mat-cell *matCellDef="let env">
          <span class="env-code">{{ env.code }}</span>
        </td>
      </ng-container>

      <!-- Libellé -->
      <ng-container matColumnDef="libelle">
        <th mat-header-cell *matHeaderCellDef>Libellé</th>
        <td mat-cell *matCellDef="let env">
          <strong>{{ env.libelle }}</strong>
        </td>
      </ng-container>

      <!-- Description -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let env">
          {{ env.description || '-' }}
        </td>
      </ng-container>

      <!-- Actif -->
      <ng-container matColumnDef="actif">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let env">
          <mat-chip
            [class.status-active]="env.actif"
            [class.status-inactive]="!env.actif">
            {{ env.actif ? 'Actif' : 'Inactif' }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let env" class="actions-cell">
          <button
            mat-icon-button
            (click)="editEnvironment($event, env)"
            matTooltip="Modifier"
            color="primary">
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            (click)="deleteEnvironment($event, env)"
            matTooltip="Supprimer"
            color="warn">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns;"
        class="clickable-row"
        (click)="openEnvironment(row)"></tr>

    </table>

    <!-- Empty state -->
    <div *ngIf="environments.length === 0" class="empty-state">
      <mat-icon>layers_clear</mat-icon>
      <p>Aucun environnement trouvé</p>
      <p class="hint">Créez votre premier environnement pour ce projet</p>
    </div>

  </mat-card>

</div>

<ng-template #loadingTpl>
  <div class="loading-state">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Chargement des environnements...</p>
  </div>
</ng-template>
