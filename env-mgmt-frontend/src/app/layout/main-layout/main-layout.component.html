<!-- src/app/layout/main-layout/main-layout.component.html -->

<mat-sidenav-container class="layout-container" autosize>

  <!-- SIDEBAR -->
  <mat-sidenav
    mode="side"
    opened
    class="sidenav"
    [class.collapsed]="isSidebarCollapsed"
    role="navigation"
    aria-label="Navigation principale">

    <!-- Header avec Logo -->
    <div class="sidebar-header">
      <div class="logo-container" [class.collapsed]="isSidebarCollapsed">
        <div class="logo-icon">
          <img
            *ngIf="!isSidebarCollapsed"
            src="/assets/images/icones/logo-perenity-software.svg"
            alt="Logo Perenity Software"
            class="logo-full"
          />
          <img
            *ngIf="isSidebarCollapsed"
            src="/assets/images/perenity_software.png"
            alt="Logo Perenity"
            class="logo-compact"
          />
        </div>

        
      </div>

      <button
        mat-icon-button
        class="toggle-btn"
        (click)="toggleSidebar()"
        [matTooltip]="isSidebarCollapsed ? 'Agrandir le menu' : 'Réduire le menu'"
        matTooltipPosition="right"
        [attr.aria-label]="isSidebarCollapsed ? 'Agrandir le menu' : 'Réduire le menu'">
        <mat-icon>{{ isSidebarCollapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
      </button>
    </div>

    <!-- Bloc Utilisateur -->
    <div class="user-block" *ngIf="context?.user as u">
      <div
        class="user-avatar"
        [attr.aria-label]="'Avatar de ' + userDisplayName">
        {{ getUserInitials() }}
      </div>

      <div class="user-info" *ngIf="!isSidebarCollapsed">
        <div class="user-name" [title]="userDisplayName">
          {{ userDisplayName }}
        </div>

        <div
          class="user-profil"
          *ngIf="userProfilLabel; else noProfilTpl"
          [title]="userProfilLabel">
          {{ userProfilLabel }}
        </div>

        <ng-template #noProfilTpl>
          <div class="user-profil muted">Profil non défini</div>
        </ng-template>

        <div class="user-email" [title]="userEmail">
          {{ userEmail }}
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-container" [attr.aria-label]="'Menu principal'">
      <mat-nav-list class="menu-list">

        <!-- Section Administration -->
        <ng-container *ngIf="visibleAdminMenu.length > 0">
          <div class="nav-section-label" *ngIf="!isSidebarCollapsed">
            Administration
          </div>

          <a
            mat-list-item
            *ngFor="let item of visibleAdminMenu"
            [routerLink]="item.route"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: false}"
            [matTooltip]="isSidebarCollapsed ? item.label : ''"
            matTooltipPosition="right"
            [matTooltipDisabled]="!isSidebarCollapsed"
            [attr.aria-label]="item.label">
            <mat-icon *ngIf="item.icon" class="nav-icon">{{ item.icon }}</mat-icon>
            <span class="nav-label" *ngIf="!isSidebarCollapsed">{{ item.label }}</span>
          </a>
        </ng-container>

        <!-- Séparateur entre admin & env si les deux existent -->
        <mat-divider *ngIf="visibleAdminMenu.length > 0 && hasEnvMenu"></mat-divider>

        <!-- Section Environnements -->
        <ng-container *ngIf="hasEnvMenu">
          <div class="nav-section-label" *ngIf="!isSidebarCollapsed">
            Environnements
          </div>

          <a
            mat-list-item
            *ngFor="let envItem of envMenu"
            [routerLink]="envItem.route"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: false}"
            [matTooltip]="isSidebarCollapsed ? envItem.label : ''"
            matTooltipPosition="right"
            [matTooltipDisabled]="!isSidebarCollapsed"
            [attr.aria-label]="envItem.label">
            <mat-icon class="nav-icon">cloud</mat-icon>
            <span class="nav-label" *ngIf="!isSidebarCollapsed">{{ envItem.label }}</span>
          </a>
        </ng-container>

      </mat-nav-list>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer">
      <button
        mat-button
        class="logout-button"
        (click)="logout()"
        [matTooltip]="isSidebarCollapsed ? 'Se déconnecter' : ''"
        matTooltipPosition="right"
        [matTooltipDisabled]="!isSidebarCollapsed"
        aria-label="Se déconnecter">
        <mat-icon>logout</mat-icon>
        <span *ngIf="!isSidebarCollapsed">Se déconnecter</span>
      </button>
    </div>
  </mat-sidenav>

  <!-- CONTENU PRINCIPAL -->
  <mat-sidenav-content>

    <!-- Toolbar -->
    <mat-toolbar class="top-toolbar" role="banner">
      <div class="toolbar-left">
        <mat-icon class="toolbar-logo" aria-hidden="true">space_dashboard</mat-icon>
        <h1 class="app-title">Environment Management</h1>
      </div>

      <span class="toolbar-spacer"></span>

      <!-- User Info Card -->
      <div class="user-card" *ngIf="context?.user as u">
        <div class="user-card-content">
          <div class="user-avatar" [attr.aria-label]="'Avatar de ' + userDisplayName">
            {{ getUserInitials() }}
          </div>

          <div class="user-details">
            <div class="user-name">{{ userDisplayName }}</div>
            <div class="user-role">
              {{ u.admin ? 'Administrateur' : 'Utilisateur' }}
            </div>
          </div>

          <mat-divider [vertical]="true"></mat-divider>

          <div class="user-status" *ngIf="u.admin" class="admin-status">
            <mat-icon>verified_user</mat-icon>
            <span>ADMIN</span>
          </div>

          <div class="user-status" *ngIf="!u.admin" class="user-status-badge">
            <mat-icon>person</mat-icon>
            <span>USER</span>
          </div>
        </div>
      </div>
    </mat-toolbar>

    <!-- Content -->
    <main class="content" role="main">
      <div class="content-inner">
        <router-outlet></router-outlet>
      </div>
    </main>

  </mat-sidenav-content>

</mat-sidenav-container>
