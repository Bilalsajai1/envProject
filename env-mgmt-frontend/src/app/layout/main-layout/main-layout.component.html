<!-- src/app/layout/main-layout/main-layout.component.html -->

<mat-sidenav-container class="layout-container">
  <mat-sidenav mode="side" opened class="sidenav">

    <!-- Logo / Brand -->
    <div class="brand-block">
      <div class="brand-icon-wrapper">
        <mat-icon class="brand-icon">hub</mat-icon>
      </div>
      <div class="brand-text">
        <div class="brand-title">PERENITY</div>
        <div class="brand-subtitle">Environment Mgmt</div>
      </div>
    </div>

    <!-- Bloc utilisateur -->
    <div class="user-block" *ngIf="context?.user as u">
      <div class="user-avatar">
        {{ getUserInitials() }}
      </div>
      <div class="user-info">
        <div class="user-name">{{ userDisplayName }}</div>
        <div class="user-profil" *ngIf="userProfilLabel; else noProfilTpl">
          {{ userProfilLabel }}
        </div>
        <ng-template #noProfilTpl>
          <div class="user-profil muted">Profil non défini</div>
        </ng-template>
        <div class="user-email" [title]="u.email">{{ u.email }}</div>
      </div>
    </div>

    <!-- 1er menu : Administration -->
    <h3 class="menu-title">Administration</h3>
    <mat-nav-list class="menu-list">
      <ng-container *ngFor="let item of visibleAdminMenu">
        <a mat-list-item
           [routerLink]="item.route"
           routerLinkActive="active"
           [routerLinkActiveOptions]="{exact: false}">
          <mat-icon *ngIf="item.icon" class="nav-icon">{{ item.icon }}</mat-icon>
          <span class="nav-label">{{ item.label }}</span>
          <span class="nav-pill" *ngIf="item.requiredRoles?.includes('ADMIN')">
            Admin only
          </span>
        </a>
      </ng-container>
    </mat-nav-list>

    <!-- 2ème menu : Environnements -->
    <h3 class="menu-title" *ngIf="hasEnvMenu">Environnements</h3>
    <mat-nav-list class="menu-list" *ngIf="hasEnvMenu">
      <a mat-list-item
         *ngFor="let envItem of envMenu"
         [routerLink]="envItem.route"
         routerLinkActive="active"
         [routerLinkActiveOptions]="{exact: false}">
        <mat-icon class="nav-icon">dns</mat-icon>
        <span class="nav-label">{{ envItem.label }}</span>
        <span class="env-chip">
          {{ envItem.env?.code }}
        </span>
      </a>
    </mat-nav-list>

    <!-- Spacer pour pousser le bouton logout en bas -->
    <div class="spacer"></div>

    <!-- Bouton Logout en bas -->
    <div class="logout-section">
      <button mat-button class="logout-button" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Se déconnecter</span>
      </button>
    </div>

  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar color="primary" class="top-toolbar">
      <div class="toolbar-left">
        <mat-icon class="toolbar-logo">space_dashboard</mat-icon>
        <span class="app-title">Environment Management</span>
      </div>

      <span class="toolbar-spacer"></span>

      <!-- Info utilisateur dans toolbar -->
      <div class="toolbar-user" *ngIf="context?.user as u">
        <div class="toolbar-user-avatar">
          {{ getUserInitials() }}
        </div>
        <div class="toolbar-user-text">
          <span class="toolbar-user-name">{{ userDisplayName }}</span>
          <span class="toolbar-user-role">
            {{ userProfilLabel || 'Utilisateur' }}
          </span>
        </div>
        <mat-chip class="admin-badge" *ngIf="u.admin">ADMIN</mat-chip>
      </div>
    </mat-toolbar>

    <div class="content">
      <div class="content-inner">
        <router-outlet></router-outlet>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
