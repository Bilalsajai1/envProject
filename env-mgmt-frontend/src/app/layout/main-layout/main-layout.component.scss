/* ============= VARIABLES CSS ============= */
:root {
  /* Couleurs Perenity */
  --perenity-primary: #152f56;
  --perenity-secondary: #074170;
  --perenity-dark: #041a33;
  --perenity-accent: #38bdf8;

  /* Transitions */
  --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Ombres */
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* ============= LAYOUT GLOBAL (Structurel uniquement) ============= */

.layout-container {
  height: 100vh;
  display: flex;
  overflow: hidden;
}
mat-sidenav-content {
  flex: 1;                /* IMPORTANT : Prend tout l'espace libre à droite de la sidebar */
  min-width: 0;           /* IMPORTANT : Empêche le contenu de déborder horizontalement */
  display: flex;          /* Flex vertical pour la Toolbar + Main */
  flex-direction: column;
  width: 100%;            /* S'assure de coller aux bords */
  margin: 0 !important;
  padding: 0 !important;
  transition: margin-left var(--transition-base); /* Fluidité si la sidebar pousse le contenu */
}
mat-sidenav-container, mat-sidenav {
  margin: 0 !important;
  padding: 0 !important;
}

/* ============= SIDEBAR (Design conservé) ============= */

.sidenav {
  width: 300px; /* Légèrement réduit pour moderniser (était 300) */
  border-right: none;
  display: flex;
  flex-direction: column;
  padding: 0;
  overflow: hidden;
  transition: width var(--transition-base);
  background: linear-gradient(165deg, #1a3a5f 0%, #074170 40%, #052642 100%);
  color: #f9fafb;
  box-shadow: 4px 0 24px rgba(15, 23, 42, 0.12);
  position: relative;

  /* Effet de brillance subtile */
  &::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 200px;
    background: radial-gradient(ellipse at top left, rgba(56, 189, 248, 0.15), transparent 60%);
    pointer-events: none;
  }
}

.sidenav.collapsed {
  width: 80px;
}

/* Header Sidebar & Logo */
.sidebar-header {
  display: flex;
  align-items: center;
  padding: 20px 16px;
  min-height: 80px;
  position: relative;
  z-index: 2;
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 14px;
  flex: 1;
  overflow: hidden; /* Empêche le débordement lors de l'animation */
}

.sidenav.collapsed .logo-container {
  justify-content: center;
  padding-left: 0;
}

.logo-full { height: 36px; width: auto; }
.logo-compact { height: 40px; width: 40px; border-radius: 12px; padding: 4px; background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); }

/* Bouton Toggle */
.toggle-btn {
  color: #e5edff;
  margin-left: auto;
  transition: transform var(--transition-fast);
  &:hover { background: rgba(255, 255, 255, 0.1); }
}
.sidenav.collapsed .toggle-btn { margin-left: 0; }

/* Bloc Utilisateur Sidebar */
.user-block {
  display: flex;
  align-items: center;
  padding: 12px;
  margin: 0 12px 16px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all var(--transition-base);
  overflow: hidden;

  &:hover { background: rgba(255, 255, 255, 0.12); }
}

.sidenav.collapsed .user-block {
  padding: 12px 0;
  justify-content: center;
  background: transparent;
  border: none;
}

.user-avatar {
  height: 40px; width: 40px; min-width: 40px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
  background: linear-gradient(135deg, #38bdf8 0%, #0284c7 100%);
  color: white;
  border: 2px solid rgba(255,255,255,0.2);
}

.user-info {
  margin-left: 12px;
  display: flex; flex-direction: column;
  min-width: 0; /* Important pour text-overflow */
  transition: opacity 0.2s;
}

.sidenav.collapsed .user-info { display: none; }

.user-name { font-size: 0.9rem; font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-profil { font-size: 0.75rem; color: #bfdbfe; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-email { font-size: 0.7rem; color: #93c5fd; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Navigation */
.nav-container {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 0 8px;
}

/* Custom Scrollbar Sidebar */
.nav-container::-webkit-scrollbar { width: 4px; }
.nav-container::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }

.menu-list .mat-mdc-list-item {
  border-radius: 8px;
  margin-bottom: 4px;
  height: 44px;
  color: #e0ecff;
  transition: all var(--transition-fast);

  &:hover { background: rgba(255, 255, 255, 0.1); color: #fff; }

  &.active {
    background: rgba(56, 189, 248, 0.15);
    color: #fff;
    border-left: 3px solid var(--perenity-accent);

    .nav-icon { color: var(--perenity-accent); }
  }
}

.nav-icon { margin-right: 12px; color: #bfdbfe; transition: color 0.2s; }
.sidenav.collapsed .nav-icon { margin-right: 0; }
.sidenav.collapsed .nav-label { display: none; }
.nav-section-label { padding: 16px 16px 8px; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.4); font-weight: 600; }

/* Footer Sidebar */
.sidebar-footer { padding: 16px; border-top: 1px solid rgba(255,255,255,0.1); }
.logout-button {
  width: 100%; color: #fca5a5;
  &:hover { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
}
.sidenav.collapsed .logout-button span { display: none; }

/* ============= TOP TOOLBAR (Design conservé) ============= */

.top-toolbar {
  position: sticky;
  top: 0;
  z-index: 10;
  height: 64px; /* Hauteur standard */
  padding: 0 24px;
  background: rgba(255, 255, 255, 0.9); /* Effet verre */
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: var(--perenity-dark);
}

.toolbar-left {
  display: flex; align-items: center; gap: 12px;
  .toolbar-logo { color: var(--perenity-primary); }
  .app-title { font-size: 1.1rem; font-weight: 600; margin: 0; letter-spacing: 0.5px; }
}

.toolbar-spacer { flex: 1; }

.user-card {
  padding: 6px 12px;
  border-radius: 30px;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  transition: box-shadow 0.2s;

  &:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

  .user-card-content { display: flex; align-items: center; gap: 10px; }
  .user-avatar { width: 32px; height: 32px; font-size: 0.8rem; box-shadow: none; border: none; }

  .user-details {
    display: flex; flex-direction: column;
    .user-name { color: var(--perenity-dark); font-size: 0.85rem; font-weight: 600; }
    .user-role { color: #64748b; font-size: 0.75rem; }
  }

  .user-status {
    font-size: 0.65rem; font-weight: 700; padding: 2px 8px; border-radius: 10px; display: flex; align-items: center; gap: 4px;
    &.admin-status { background: #dcfce7; color: #15803d; }
    &.user-status-badge { background: #dbeafe; color: #1e40af; }
    mat-icon { font-size: 14px; height: 14px; width: 14px; }
  }
}

/* ============= ZONE DE CONTENU PRINCIPAL (NEUTRALISÉE) ============= */

.content {
  /* Layout Essentiel */
  flex: 1;
  display: block; /* Pas de flexbox ici */
  box-sizing: border-box;

  /* Gestion du Scroll : La sidebar et le header sont fixes, seul le contenu scroll */
  height: calc(100vh - 64px); /* 100vh - hauteur toolbar */
  overflow-y: auto;
  overflow-x: hidden;

  /* Esthétique Neutre */
  background-color: #f1f5f9; /* Gris très léger, standard pour le fond d'app */
  padding: 0; /* Laissez les composants enfants gérer leurs marges (padding 2rem etc.) */

  /* Scrollbar propre mais discrète */
  &::-webkit-scrollbar { width: 8px; }
  &::-webkit-scrollbar-track { background: transparent; }
  &::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.4); border-radius: 4px; }
  &::-webkit-scrollbar-thumb:hover { background: rgba(148, 163, 184, 0.6); }
}

/* Wrapper interne : totalement transparent */
.content-inner {
  width: 100%;
  height: 100%; /* Permet aux enfants d'utiliser height: 100% si besoin */
  position: relative;
  /* Suppression de l'animation globale fadeInUp pour ne pas gêner les pages */
}

/* ============= RESPONSIVE ============= */

@media (max-width: 768px) {
  .sidenav {
    position: fixed; z-index: 100; height: 100%;
    /* En mobile, on cache la sidebar par défaut ou on la gère via TS */
  }

  /* Ajustement toolbar mobile */
  .top-toolbar { padding: 0 16px; }
  .user-details, .user-status { display: none; }
  .user-card { padding: 4px; background: transparent; border: none; }
}
