<div class="form-container">
  @if (loading) {
    <mat-progress-bar
      mode="indeterminate"
      color="primary"
      class="loading-bar">
    </mat-progress-bar>
  }

  <div class="form-header">
    <div>
      <h1>{{ isEdit ? 'Modifier un profil' : 'Nouveau profil' }}</h1>
      <p class="subtitle">
        {{ isEdit ? 'Mise à jour des informations' : 'Création d\'un nouveau profil' }}
      </p>
    </div>

    <button mat-button type="button" (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
      Retour à la liste
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="profil-form">
    <div class="form-grid">
      <mat-form-field appearance="outline">
        <mat-label>Code</mat-label>
        <input matInput formControlName="code" />

        @if (form.get('code')?.hasError('required')) {
          <mat-error>
            Code obligatoire
          </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Libellé</mat-label>
        <input matInput formControlName="libelle" />

        @if (form.get('libelle')?.hasError('required')) {
          <mat-error>
            Libellé obligatoire
          </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput rows="3" formControlName="description"></textarea>
      </mat-form-field>

      <div class="checkbox-group">
        <mat-checkbox formControlName="admin">
          Profil administrateur
        </mat-checkbox>
        <mat-hint class="admin-hint">
          <mat-icon>info</mat-icon>
          Les profils administrateurs ont accès complet à toutes les fonctionnalités
        </mat-hint>
      </div>

      <mat-slide-toggle formControlName="actif">
        Actif
      </mat-slide-toggle>
    </div>

    <div class="form-actions">
      <button mat-stroked-button type="button" (click)="cancel()">
        Annuler
      </button>

      <button mat-raised-button color="primary" type="submit" [disabled]="saving">
        @if (saving) {
          <mat-progress-spinner
            mode="indeterminate"
            diameter="16"
            strokeWidth="2">
          </mat-progress-spinner>
          <span>Enregistrement...</span>
        } @else {
          <span>
            {{ isEdit ? 'Enregistrer' : 'Créer' }}
          </span>
        }
      </button>
    </div>
  </form>
</div>
