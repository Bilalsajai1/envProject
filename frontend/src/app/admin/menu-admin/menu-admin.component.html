<!-- src/app/admin/menu-admin/menu-admin.component.html -->
<div class="page-card">
  <div class="page-header">
    <div>
      <div class="page-title">Gestion des menus</div>
      <div class="page-subtitle">
        Administration des menus de la plateforme et de leurs rôles associés.
      </div>
    </div>
    <div class="page-actions">
      <button class="primary" (click)="openCreateForm()">+ Nouveau menu</button>
    </div>
  </div>

  <div *ngIf="loading">Chargement...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <table class="table" *ngIf="!loading && menus.length > 0">
    <thead>
    <tr>
      <th>Code</th>
      <th>Libellé</th>
      <th>Route</th>
      <th>Icône</th>
      <th>Ordre</th>
      <th>Visible</th>
      <th style="width: 220px;">Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let m of menus">
      <td>{{ m.code }}</td>
      <td>{{ m.libelle }}</td>
      <td>{{ m.route }}</td>
      <td>{{ m.icon }}</td>
      <td>{{ m.ordre }}</td>
      <td>{{ m.visible ? 'Oui' : 'Non' }}</td>
      <td class="table-actions">
        <button class="secondary" (click)="openEditForm(m)">Modifier</button>
        <button class="secondary" (click)="openRolesPanel(m)">Rôles</button>
        <button class="danger" (click)="deleteMenu(m)">Supprimer</button>
      </td>
    </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && menus.length === 0" class="empty-state">
    Aucun menu pour le moment.
  </div>

  <!-- FORM -->
  <div *ngIf="showForm" class="form-card">
    <h3>{{ isEditing ? 'Modifier un menu' : 'Nouveau menu' }}</h3>

    <form (ngSubmit)="submitForm()">
      <div class="form-row">
        <label>Code *</label>
        <input [(ngModel)]="form.code" name="code" />
      </div>

      <div class="form-row">
        <label>Libellé *</label>
        <input [(ngModel)]="form.libelle" name="libelle" />
      </div>

      <div class="form-row">
        <label>Route</label>
        <input [(ngModel)]="form.route" name="route" />
      </div>

      <div class="form-row">
        <label>Icône (classe FontAwesome)</label>
        <input [(ngModel)]="form.icon" name="icon" />
      </div>

      <div class="form-row">
        <label>Ordre</label>
        <input type="number" [(ngModel)]="form.ordre" name="ordre" />
      </div>

      <div class="form-row">
        <label>
          <input type="checkbox" [(ngModel)]="form.visible" name="visible" />
          Visible
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="primary">
          {{ isEditing ? 'Enregistrer' : 'Créer' }}
        </button>
        <button type="button" class="secondary" (click)="cancelForm()">Annuler</button>
      </div>
    </form>
  </div>

  <!-- PANEL RÔLES -->
  <div *ngIf="showRolesPanel" class="form-card">
    <h3>Rôles du menu : {{ currentMenuForRoles?.code }}</h3>

    <div *ngIf="loadingRoles">Chargement des rôles...</div>

    <div *ngIf="!loadingRoles">
      <div *ngIf="allRoles.length === 0">Aucun rôle défini.</div>

      <div class="roles-list" *ngIf="allRoles.length > 0">
        <label *ngFor="let r of allRoles" class="role-item">
          <input
            type="checkbox"
            [checked]="selectedRoleIds.has(r.id)"
            (change)="toggleRole(r.id)"
          />
          <span class="role-code">{{ r.code }}</span>
          <span class="role-libelle">{{ r.libelle }}</span>
          <span class="role-action">
            ({{ getRoleActionLabel(r.action) }})
          </span>
        </label>
      </div>
    </div>

    <div class="form-actions">
      <button class="primary" (click)="saveRoles()">Enregistrer les rôles</button>
      <button class="secondary" type="button" (click)="closeRolesPanel()">Fermer</button>
    </div>
  </div>
</div>
