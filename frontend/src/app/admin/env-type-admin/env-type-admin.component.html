<div class="env-type-admin">
  <div class="header">
    <div class="titles">
      <h1>Administration des environnements</h1>
      <p>
        Type d'environnement :
        <span class="chip-primary">{{ typeLabel || typeCode }}</span>
      </p>
    </div>

    <div class="actions-grid">
      <div class="action-card">
        <h3>Type</h3>
        <div class="btn-group">
          <button (click)="onAction('TYPE', 'CONSULT')">CONSULT</button>
          <button (click)="onAction('TYPE', 'CREATE')">CREATE</button>
          <button (click)="onAction('TYPE', 'UPDATE')">UPDATE</button>
          <button (click)="onAction('TYPE', 'DELETE')">DELETE</button>
        </div>
      </div>

      <div class="action-card">
        <h3>Projet</h3>
        <div class="btn-group">
          <button (click)="onAction('PROJET', 'CONSULT', selectedProjet)" [disabled]="!selectedProjet">CONSULT</button>
          <button (click)="onAction('PROJET', 'CREATE')">CREATE</button>
          <button (click)="onAction('PROJET', 'UPDATE', selectedProjet)" [disabled]="!selectedProjet">UPDATE</button>
          <button (click)="onAction('PROJET', 'DELETE', selectedProjet)" [disabled]="!selectedProjet">DELETE</button>
        </div>
      </div>

      <div class="action-card">
        <h3>Environnement</h3>
        <div class="btn-group">
          <button (click)="onAction('ENV', 'CONSULT', selectedEnv)" [disabled]="!selectedEnv">CONSULT</button>
          <button (click)="onAction('ENV', 'CREATE', selectedProjet)" [disabled]="!selectedProjet">CREATE</button>
          <button (click)="onAction('ENV', 'UPDATE', selectedEnv)" [disabled]="!selectedEnv">UPDATE</button>
          <button (click)="onAction('ENV', 'DELETE', selectedEnv)" [disabled]="!selectedEnv">DELETE</button>
        </div>
      </div>
    </div>
  </div>

  <div class="content">

    <!-- COL 1 : PROJETS -->
    <div class="col">
      <h2>Projets</h2>
      <div *ngIf="projets.length === 0 && !loading" class="empty">
        Aucun projet pour ce type.
      </div>

      <div class="list">
        <button
          *ngFor="let p of projets"
          class="item"
          (click)="selectProjet(p)"
          [class.active]="selectedProjet?.id === p.id"
        >
          <div class="title">{{ p.libelle || p.code }}</div>
          <div class="subtitle">{{ p.code }}</div>
        </button>
      </div>
    </div>

    <!-- COL 2 : ENVIRONNEMENTS -->
    <div class="col">
      <h2>Environnements</h2>
      <div *ngIf="environnements.length === 0 && selectedProjet" class="empty">
        Aucun environnement pour ce projet.
      </div>

      <div class="list">
        <button
          *ngFor="let e of environnements"
          class="item"
          (click)="selectEnv(e)"
          [class.active]="selectedEnv?.id === e.id"
        >
          <div class="title">{{ e.libelle || e.code }}</div>
          <div class="subtitle">{{ e.code }}</div>
        </button>
      </div>
    </div>

    <!-- COL 3 : APPLICATIONS D'ENV -->
    <div class="col">
      <h2>Applications ({{ envApps.length }})</h2>
      <div *ngIf="envApps.length === 0 && selectedEnv" class="empty">
        Aucune application configur√©e pour cet environnement.
      </div>

      <div class="apps">
        <div class="app-card" *ngFor="let app of envApps">
          <div class="app-header">
            <div>
              <div class="app-title">
                {{ app.applicationLibelle || app.applicationCode }}
              </div>
              <div class="app-subtitle">
                {{ app.applicationCode }}
              </div>
            </div>
            <span class="status" [class.inactive]="app.actif === false">
              {{ app.actif === false ? 'INACTIF' : 'ACTIF' }}
            </span>
          </div>

          <div class="app-body">
            <div class="line">
              <span class="label">Endpoint</span>
              <span class="value">
                {{ app.protocole || 'http' }}://{{ app.host }}<span *ngIf="app.port">:{{ app.port }}</span>
              </span>
            </div>
            <div class="line" *ngIf="app.url">
              <span class="label">URL</span>
              <span class="value">{{ app.url }}</span>
            </div>
            <div class="line" *ngIf="app.description">
              <span class="label">Description</span>
              <span class="value">{{ app.description }}</span>
            </div>
          </div>

          <div class="app-actions">
            <button (click)="onAction('APP', 'CONSULT', app)">CONSULT</button>
            <button (click)="onAction('APP', 'CREATE', selectedEnv)">CREATE</button>
            <button (click)="onAction('APP', 'UPDATE', app)">UPDATE</button>
            <button (click)="onAction('APP', 'DELETE', app)">DELETE</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
