

<div class="change-password-page">
  <header class="page-header">
    <div class="header-left">
      <mat-icon>key</mat-icon>
      <div>
        <h1>Changer mon mot de passe</h1>
        <p>Mettez à jour votre mot de passe en toute sécurité.</p>
      </div>
    </div>
    <button mat-stroked-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Retour
    </button>
  </header>

  <section class="content-card">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="form-grid">

        <mat-form-field appearance="fill">
          <mat-label>Mot de passe actuel</mat-label>
          <input matInput [type]="hideCurrent ? 'password' : 'text'" formControlName="currentPassword" autocomplete="current-password">
          <button mat-icon-button matSuffix type="button" (click)="toggle('current')" [attr.aria-label]="hideCurrent ? 'Afficher' : 'Masquer'">
            <mat-icon>{{ hideCurrent ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="currentPassword?.hasError('required')">Requis</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Nouveau mot de passe</mat-label>
          <input matInput [type]="hideNew ? 'password' : 'text'" formControlName="newPassword" autocomplete="new-password">
          <button mat-icon-button matSuffix type="button" (click)="toggle('new')" [attr.aria-label]="hideNew ? 'Afficher' : 'Masquer'">
            <mat-icon>{{ hideNew ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-hint>8 caractères minimum</mat-hint>
          <mat-error *ngIf="newPassword?.hasError('required')">Requis</mat-error>
          <mat-error *ngIf="newPassword?.hasError('minlength')">Au moins 8 caractères</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Confirmer</mat-label>
          <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirmPassword" autocomplete="new-password">
          <button mat-icon-button matSuffix type="button" (click)="toggle('confirm')" [attr.aria-label]="hideConfirm ? 'Afficher' : 'Masquer'">
            <mat-icon>{{ hideConfirm ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="confirmPassword?.hasError('required')">Requis</mat-error>
          <mat-error *ngIf="form.hasError('passwordMismatch') && confirmPassword?.touched">
            Les mots de passe ne correspondent pas
          </mat-error>
        </mat-form-field>

      </div>

      <div class="actions">
        <button mat-stroked-button type="button" (click)="goBack()">
          Annuler
        </button>
        <button mat-raised-button color="primary" type="submit" [disabled]="saving">
          <mat-spinner *ngIf="saving" diameter="18"></mat-spinner>
          <span *ngIf="!saving">Enregistrer</span>
        </button>
      </div>
    </form>
  </section>
</div>

