<div class="page-card">

  <div class="page-header">
    <div>
      <div class="page-title">Types d'environnement</div>
      <div class="page-subtitle">
        Gestion des types + accès aux projets par type.
      </div>
    </div>

    <button class="primary" (click)="openCreateForm()">+ Type d'environnement</button>
  </div>

  @if (loading) {
    <div>Chargement...</div>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading && !error && types.length > 0) {
    <table class="table">
      <thead>
      <tr>
        <th>Code</th>
        <th>Libellé</th>
        <th>Actif</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>
        @for (type of types; track type.code) {
          <tr class="clickable-row" (click)="goToTypeProjects(type)">
            <td>
              <span class="type-code-link">{{ type.code }}</span>
            </td>
            <td>{{ type.libelle }}</td>
            <td>{{ type.actif ? 'Oui' : 'Non' }}</td>
            <td class="table-actions">
              <button class="secondary"
                      (click)="$event.stopPropagation(); openEditForm(type)">
                Modifier
              </button>
              <button class="danger"
                      (click)="$event.stopPropagation(); delete(type)">
                Supprimer
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (!loading && !error) {
    @if (types.length > 0) {
    } @else {
      <div class="empty-state">Aucun type d'environnement défini.</div>
    }
  }

  @if (showForm) {
    <div class="form-card">
      <h3>{{ isEditing ? 'Modifier un type' : 'Nouveau type' }}</h3>

      <div class="form-field">
        <label>Code</label>
        <input [(ngModel)]="form.code" name="code">
      </div>

      <div class="form-field">
        <label>Libellé</label>
        <input [(ngModel)]="form.libelle" name="libelle">
      </div>

      <div class="form-checkbox">
        <input type="checkbox" [(ngModel)]="form.actif" name="actif">
        <span>Actif</span>
      </div>

      <div class="form-actions">
        <button class="primary" (click)="submit()">Enregistrer</button>
        <button class="secondary" type="button" (click)="cancel()">Annuler</button>
      </div>
    </div>
  }

</div>
