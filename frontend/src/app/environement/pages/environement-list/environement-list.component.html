<h2>Environnements du projet {{ projectId }} (type {{ typeCode }})</h2>

<div class="toolbar">
  <button (click)="goBack()">← Retour</button>
  <button (click)="openCreateForm()">+ Environnement</button>
</div>

@if (loading) {
  <div>Chargement...</div>
}

@if (error) {
  <div class="error">{{ error }}</div>
}

@if (showForm) {
  <div class="form-card">
    <h3>{{ isEditing ? 'Modifier un environnement' : 'Nouvel environnement' }}</h3>

    <form (ngSubmit)="submitForm()">
      <div>
        <label>Code</label>
        <input type="text" [(ngModel)]="form.code" name="code" required />
      </div>
      <div>
        <label>Libellé</label>
        <input type="text" [(ngModel)]="form.libelle" name="libelle" required />
      </div>
      <div>
        <label>Description</label>
        <textarea [(ngModel)]="form.description" name="description"></textarea>
      </div>
      <div>
        <label>
          <input type="checkbox" [(ngModel)]="form.actif" name="actif" />
          Actif
        </label>
      </div>

      <div class="form-actions">
        <button type="submit">
          {{ isEditing ? 'Enregistrer' : 'Créer' }}
        </button>
        <button type="button" (click)="cancelForm()">Annuler</button>
      </div>
    </form>
  </div>
}

@if (!loading && !error && environments.length > 0) {
  <table class="table">
    <thead>
    <tr>
      <th>Code</th>
      <th>Libellé</th>
      <th>Description</th>
      <th>Actif</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
      @for (env of environments; track env.code) {
        <tr>
          <td>{{ env.code }}</td>
          <td>{{ env.libelle }}</td>
          <td>{{ env.description }}</td>
          <td>{{ env.actif ? 'Oui' : 'Non' }}</td>
          <td>
            <button (click)="openApplications(env)">Applications</button>
            <button (click)="openEditForm(env)">Modifier</button>
            <button (click)="deleteEnv(env)">Supprimer</button>
          </td>
        </tr>
      }
    </tbody>
  </table>
}

@if (!loading && !error && environments.length === 0) {
  <div>
    Aucun environnement pour ce projet / type.
  </div>
}
