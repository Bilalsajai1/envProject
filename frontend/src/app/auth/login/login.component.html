<div class="account-pages">
  <div class="container login-page-container">
    <div class="row justify-content-center">
      <!-- ✅ ULTRA COMPACT: col-sm-10 col-md-6 col-lg-4 col-xl-3 -->
      <div class="col-sm-10 col-md-6 col-lg-4 col-xl-3">
        <div class="card login-card overflow-hidden">

          <div class="card-header text-center border-0 bg-transparent">
            <div class="mb-3">
              <img
                src="assets/images/icones/logo-perenity-software.svg"
                class="login-logo img-fluid"
                alt="Perenity Software"
              />
            </div>
            <h4 class="mb-1 text-primary">Bienvenue</h4>
            <p class="text-muted mb-0">Connectez-vous</p>
            <hr class="mt-3 mb-0" />
          </div>

          <div class="card-body">

            @if (error) {
              <div class="alert alert-danger mb-3">
                <mat-icon>error_outline</mat-icon>
                <span>{{ error }}</span>
              </div>
            }

            <form [formGroup]="form" (ngSubmit)="submit()">

              <div class="mb-3">
                <label class="form-label">Utilisateur</label>
                <mat-form-field appearance="outline" class="w-100">
                  <mat-icon matPrefix>person</mat-icon>
                  <input
                    matInput
                    formControlName="username"
                    autocomplete="username"
                  />
                  @if (form.get('username')?.touched && form.get('username')?.hasError('required')) {
                    <mat-error>Obligatoire</mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="mb-3">
                <label class="form-label">Mot de passe</label>
                <mat-form-field appearance="outline" class="w-100">
                  <mat-icon matPrefix>lock</mat-icon>
                  <input
                    matInput
                    [type]="hidePassword ? 'password' : 'text'"
                    formControlName="password"
                    autocomplete="current-password"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    type="button"
                    (click)="hidePassword = !hidePassword"
                    [attr.aria-label]="'Masquer le mot de passe'"
                    tabindex="-1"
                  >
                    <mat-icon>
                      {{ hidePassword ? 'visibility_off' : 'visibility' }}
                    </mat-icon>
                  </button>
                  @if (form.get('password')?.touched && form.get('password')?.hasError('required')) {
                    <mat-error>Obligatoire</mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="mb-3 text-center">
                <mat-checkbox formControlName="rememberMe">
                  Se souvenir
                </mat-checkbox>
              </div>

              <div class="mb-3">
                <button
                  mat-raised-button
                  color="primary"
                  class="w-100 login-button"
                  type="submit"
                  [disabled]="loading || form.invalid"
                >
                  @if (loading) {
                    <mat-progress-spinner
                      diameter="20"
                      mode="indeterminate"
                      strokeWidth="2"
                      class="spinner"
                    >
                    </mat-progress-spinner>
                    <span>Connexion...</span>
                  } @else {
                    <span>Connexion</span>
                  }
                </button>
              </div>

              <div class="text-center">

                <a class="forgot-password-link"
                (click)="goToForgotPassword()"
                >
                <mat-icon>lock</mat-icon>
                <span>Mot de passe oublié ?</span>
                </a>
              </div>

            </form>
          </div>

          <div class="card-footer text-center bg-transparent border-0">
            <p class="mb-0">© 2025 Perenity</p>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
