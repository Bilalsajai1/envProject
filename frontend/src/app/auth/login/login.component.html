<div class="login-screen">
  <img src="assets/images/image.jpg" alt="Perenity background" class="login-bg" />
  <div class="login-overlay"></div>

  <div class="login-card-wrapper">
    <button class="theme-toggle" type="button" (click)="toggleTheme()">
      @if (currentTheme === 'light') {
        <mat-icon>dark_mode</mat-icon>
      } @else {
        <mat-icon>light_mode</mat-icon>
      }
    </button>

    <div class="login-card">
      <div class="card-header text-center border-0 bg-transparent">
        <div class="brand solo-logo">
          <img
            src="assets/images/icones/logo-perenity-software.svg"
            class="login-logo"
            alt="Perenity Software"
          />
        </div>
      </div>

      <div class="card-body">

        @if (error) {
          <div class="alert alert-danger mb-3">
            <mat-icon>error_outline</mat-icon>
            <span>{{ error }}</span>
          </div>
        }

        <form [formGroup]="form" (ngSubmit)="submit()">

          <div class="mb-3">
            <label class="form-label">Utilisateur</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-icon matPrefix>person</mat-icon>
              <input
                matInput
                formControlName="username"
                autocomplete="username"
                placeholder="email@domaine.com"
              />
              @if (form.get('username')?.touched && form.get('username')?.hasError('required')) {
                <mat-error>Obligatoire</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="mb-3">
            <label class="form-label">Mot de passe</label>
            <mat-form-field appearance="outline" class="w-100">
              <mat-icon matPrefix>lock</mat-icon>
              <input
                matInput
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="password"
                autocomplete="current-password"
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hidePassword = !hidePassword"
                [attr.aria-label]="'Masquer le mot de passe'"
                tabindex="-1"
              >
                <mat-icon>
                  {{ hidePassword ? 'visibility_off' : 'visibility' }}
                </mat-icon>
              </button>
              @if (form.get('password')?.touched && form.get('password')?.hasError('required')) {
                <mat-error>Obligatoire</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="mb-3 text-center remember-block">
            <mat-checkbox formControlName="rememberMe">
              Se souvenir de moi
            </mat-checkbox>
            <a class="forgot-password-link" (click)="goToForgotPassword()">
              <mat-icon>lock</mat-icon>
              <span>Mot de passe oublié ?</span>
            </a>
          </div>

          <div class="mb-3">
            <button
              mat-raised-button
              color="primary"
              class="w-100 login-button"
              type="submit"
              [disabled]="loading || form.invalid"
            >
              @if (loading) {
                <mat-progress-spinner
                  diameter="20"
                  mode="indeterminate"
                  strokeWidth="2"
                  class="spinner"
                >
                </mat-progress-spinner>
                <span>Connexion...</span>
              } @else {
                <span>Connexion</span>
              }
            </button>
          </div>
        </form>
      </div>

      <div class="card-footer text-center bg-transparent border-0">
        <p class="mb-0">© 2025 Perenity</p>
      </div>
    </div>
  </div>
</div>
