<div class="auth-container">
  
  <div class="animated-bg">
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
  </div>

  
  <button class="theme-toggle-btn" (click)="toggleTheme()" type="button">
    <div class="toggle-icon-wrapper">
      @if (currentTheme === 'light') {
        <mat-icon class="icon-sun">wb_sunny</mat-icon>
      } @else {
        <mat-icon class="icon-moon">nights_stay</mat-icon>
      }
    </div>
  </button>

  
  <div class="auth-card-centered">
    <div class="card-header-icon">
      <div class="icon-circle">
        <mat-icon>vpn_key</mat-icon>
      </div>
    </div>

    <div class="card-content">
      <h1 class="card-title">Nouveau mot de passe</h1>
      <p class="card-subtitle">Créez un mot de passe fort et sécurisé pour votre compte.</p>

      @if (tokenInvalid) {
        <div class="error-message">
          <div class="error-icon">
            <mat-icon>error_outline</mat-icon>
          </div>
          <div class="error-content">
            <h3>Lien invalide ou expiré</h3>
            <p>Le lien de réinitialisation n'est plus valide. Veuillez demander un nouveau lien.</p>
          </div>
        </div>
      } @else {
        <form [formGroup]="form" (ngSubmit)="submit()" class="reset-form">
          
          <div class="form-group">
            <label class="form-label">
              <mat-icon class="label-icon">lock</mat-icon>
              Nouveau mot de passe
            </label>
            <div class="input-wrapper">
              <input
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="password"
                class="form-input"
                placeholder="••••••••"
                autocomplete="new-password"
              />
              <button
                type="button"
                class="input-action-btn"
                (click)="hidePassword = !hidePassword"
                tabindex="-1"
              >
                <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <div class="input-border"></div>
            </div>
            @if (form.get('password')?.touched && form.get('password')?.hasError('required')) {
              <span class="field-error">Le mot de passe est obligatoire</span>
            }
            @if (form.get('password')?.touched && form.get('password')?.hasError('minlength')) {
              <span class="field-error">Minimum 8 caractères requis</span>
            }
            <div class="password-strength">
              <div class="strength-label">Force du mot de passe</div>
              <div class="strength-bar">
                <div class="strength-fill" [class.weak]="form.get('password')?.value?.length < 8"
                     [class.medium]="form.get('password')?.value?.length >= 8 && form.get('password')?.value?.length < 12"
                     [class.strong]="form.get('password')?.value?.length >= 12"></div>
              </div>
            </div>
          </div>

          
          <div class="form-group">
            <label class="form-label">
              <mat-icon class="label-icon">lock_clock</mat-icon>
              Confirmer le mot de passe
            </label>
            <div class="input-wrapper">
              <input
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
                class="form-input"
                placeholder="••••••••"
                autocomplete="new-password"
              />
              <button
                type="button"
                class="input-action-btn"
                (click)="hideConfirmPassword = !hideConfirmPassword"
                tabindex="-1"
              >
                <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <div class="input-border"></div>
            </div>
            @if (form.get('confirmPassword')?.touched && form.get('confirmPassword')?.hasError('required')) {
              <span class="field-error">La confirmation est obligatoire</span>
            }
            @if (form.hasError('passwordMismatch') && form.get('confirmPassword')?.touched) {
              <span class="field-error">Les mots de passe ne correspondent pas</span>
            }
          </div>

          <button
            type="submit"
            class="btn-submit"
            [class.loading]="loading"
            [disabled]="loading || form.invalid"
          >
            @if (loading) {
              <div class="btn-loader">
                <div class="loader-spinner"></div>
                <span>Réinitialisation...</span>
              </div>
            } @else {
              <mat-icon class="btn-icon">check_circle</mat-icon>
              <span class="btn-text">Réinitialiser</span>
            }
          </button>
        </form>
      }

      <button class="btn-back" (click)="goBack()" [disabled]="loading">
        <mat-icon>arrow_back</mat-icon>
        <span>Retour à la connexion</span>
      </button>

      <div class="card-footer">
        <p class="copyright">© 2025 Perenity Software</p>
      </div>
    </div>
  </div>
</div>

